<mxfile host="app.diagrams.net">
  <diagram name="API Auth Flow" id="diagram1">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="2400">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="title1" value="API Authentication and Authorization Flow - Internal API (Type 5 and 6)" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="700" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="h1" value="API Consumer" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#2E7D32;strokeColor=#1B5E20;fontColor=#FFFFFF;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="70" width="200" height="35" as="geometry"/>
        </mxCell>
        <mxCell id="h2" value="API Gateway" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#424242;strokeColor=#212121;fontColor=#FFFFFF;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="70" width="200" height="35" as="geometry"/>
        </mxCell>
        <mxCell id="h3" value="Identity Provider (IdP)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#424242;strokeColor=#212121;fontColor=#FFFFFF;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="70" width="200" height="35" as="geometry"/>
        </mxCell>
        <mxCell id="h4" value="API Provider" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#1565C0;strokeColor=#0D47A1;fontColor=#FFFFFF;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="70" width="200" height="35" as="geometry"/>
        </mxCell>
        <mxCell id="l1" value="" style="endArrow=none;dashed=1;html=1;strokeWidth=2;strokeColor=#2E7D32;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="150" y="120" as="sourcePoint"/>
            <mxPoint x="150" y="2200" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="l2" value="" style="endArrow=none;dashed=1;html=1;strokeWidth=2;strokeColor=#424242;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="120" as="sourcePoint"/>
            <mxPoint x="400" y="2200" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="l3" value="" style="endArrow=none;dashed=1;html=1;strokeWidth=2;strokeColor=#424242;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="650" y="120" as="sourcePoint"/>
            <mxPoint x="650" y="2200" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="l4" value="" style="endArrow=none;dashed=1;html=1;strokeWidth=2;strokeColor=#1565C0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="120" as="sourcePoint"/>
            <mxPoint x="900" y="2200" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="auth1" value="Authentication: OAuth 2.0 - Client Assertion Type - JWT Bearer (RFC-7523)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFB74D;strokeColor=#F57C00;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="150" width="950" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="s1" value="1. Initiate API request" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="70" y="200" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="s2" value="2. Generate signed JWT" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="70" y="270" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a1" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;" edge="1" parent="1" source="s1" target="s2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="150" y="240" as="sourcePoint"/>
            <mxPoint x="150" y="270" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s3" value="3. POST /v1/oauth/tokens" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="70" y="340" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a2" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;" edge="1" parent="1" source="s2" target="s3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="150" y="310" as="sourcePoint"/>
            <mxPoint x="150" y="340" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s4" value="4. Auth server validates JWT" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#616161;strokeColor=#424242;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="570" y="340" width="150" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a3" value="Send JWT" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;" edge="1" parent="1" source="s3" target="s4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="360" as="sourcePoint"/>
            <mxPoint x="570" y="360" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s5" value="5. Auth server validates scope" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#616161;strokeColor=#424242;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="570" y="410" width="150" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a4" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#424242;" edge="1" parent="1" source="s4" target="s5">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="645" y="380" as="sourcePoint"/>
            <mxPoint x="645" y="410" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="alt1" value="ALT [Authentication FAILED]" style="text;html=1;align=left;verticalAlign=top;fontColor=#C62828;fontStyle=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="60" y="470" width="200" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="s6" value="6. 401: Unauthorized" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="320" y="510" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a6" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#C62828;dashed=1;" edge="1" parent="1" source="s5" target="s6">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="570" y="530" as="sourcePoint"/>
            <mxPoint x="460" y="530" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s7" value="7. 401: Unauthorized" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#C62828;" vertex="1" parent="1">
          <mxGeometry x="70" y="560" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a7" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#C62828;dashed=1;" edge="1" parent="1" source="s6" target="s7">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="580" as="sourcePoint"/>
            <mxPoint x="210" y="580" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="alt2" value="ALT [Authentication SUCCESS]" style="text;html=1;align=left;verticalAlign=top;fontColor=#2E7D32;fontStyle=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="60" y="620" width="200" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="s8" value="8. Generate Access and Refresh Token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#616161;strokeColor=#424242;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="570" y="660" width="150" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="a8" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;" edge="1" parent="1" source="s5" target="s8">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="645" y="450" as="sourcePoint"/>
            <mxPoint x="645" y="660" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s9" value="9. Return Access and Refresh Token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="320" y="730" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="a9" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;dashed=1;" edge="1" parent="1" source="s8" target="s9">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="570" y="755" as="sourcePoint"/>
            <mxPoint x="460" y="755" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s10" value="10. Return Access and Refresh Token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="70" y="800" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="a10" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;dashed=1;" edge="1" parent="1" source="s9" target="s10">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="825" as="sourcePoint"/>
            <mxPoint x="210" y="825" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="auth2" value="Authorization: OAuth 2.0 - Grant Type - JWT Bearer (RFC-7523)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFB74D;strokeColor=#F57C00;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="890" width="950" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="s11" value="11. Use Access Token in API requests" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="70" y="940" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="s12" value="12. Perform API Gateway policies" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#616161;strokeColor=#424242;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="320" y="940" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="a11" value="with Access Token" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;" edge="1" parent="1" source="s11" target="s12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="965" as="sourcePoint"/>
            <mxPoint x="320" y="965" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s13" value="13. Forward request with Access Token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#616161;strokeColor=#424242;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="320" y="1040" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="a12" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#424242;" edge="1" parent="1" source="s12" target="s13">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="990" as="sourcePoint"/>
            <mxPoint x="390" y="1040" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s14" value="14. Validate Access Token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="820" y="1040" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="a13" value="Forward with token" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#1565C0;" edge="1" parent="1" source="s13" target="s14">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="1065" as="sourcePoint"/>
            <mxPoint x="820" y="1065" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s15" value="15. Forward request" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="820" y="1140" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a14" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#1565C0;" edge="1" parent="1" source="s14" target="s15">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="890" y="1090" as="sourcePoint"/>
            <mxPoint x="890" y="1140" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s16" value="16. Perform fine-grained authorization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="820" y="1210" width="140" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="a15" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#1565C0;" edge="1" parent="1" source="s15" target="s16">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="890" y="1180" as="sourcePoint"/>
            <mxPoint x="890" y="1210" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s17" value="17. Perform business logic" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1565C0;" vertex="1" parent="1">
          <mxGeometry x="820" y="1290" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a16" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#1565C0;" edge="1" parent="1" source="s16" target="s17">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="890" y="1260" as="sourcePoint"/>
            <mxPoint x="890" y="1290" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s18" value="18. 200: OK" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="820" y="1360" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a17" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;dashed=1;" edge="1" parent="1" source="s17" target="s18">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="890" y="1330" as="sourcePoint"/>
            <mxPoint x="890" y="1360" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s19" value="19. 200: OK" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="320" y="1430" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a18" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;dashed=1;" edge="1" parent="1" source="s18" target="s19">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="820" y="1450" as="sourcePoint"/>
            <mxPoint x="460" y="1450" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="s20" value="20. 200: OK" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#2E7D32;" vertex="1" parent="1">
          <mxGeometry x="70" y="1500" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a19" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2E7D32;dashed=1;" edge="1" parent="1" source="s19" target="s20">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="1520" as="sourcePoint"/>
            <mxPoint x="210" y="1520" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>